{% extends 'base.html' %}
{% load static %}

{% block content %}

<div class="container my-3">

  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center">
    <h3><i class="bi bi-bag"></i> Nueva Venta</h3>
    <a href="{% url 'lista_ventas' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Volver al listado
    </a>
  </div>

  <!-- Barra de búsqueda y agregar por ID -->
  <div class="row g-3 mt-3">
    <div class="col-md-6">
      <input id="search" type="text" class="form-control"
             placeholder="Buscar producto por nombre...">
    </div>
    <div class="col-md-4">
      <input id="codigoInput" type="text" class="form-control"
             placeholder="Agregar por ID">
    </div>
    <div class="col-md-2">
      <button id="btnBuscarCodigo" class="btn btn-primary w-100">
        <i class="bi bi-plus-lg"></i> Agregar
      </button>
    </div>
  </div>

  <!-- Productos -->
  <div class="row mt-3" id="product-list">
    <!-- JS insertará productos aquí -->
  </div>

  <hr>

  <!-- Carrito -->
  <h5><i class="bi bi-cart2"></i> Carrito</h5>
  <div class="table-responsive">
    <table class="table table-sm table-striped align-middle">
      <thead>
        <tr>
          <th style="width: 10%">ID</th>
          <th style="width: 50%">Producto</th>
          <th style="width: 15%">Cant.</th>
          <th style="width: 15%">Subtotal</th>
          <th style="width: 10%"></th>
        </tr>
      </thead>
      <tbody id="carritoBody"></tbody>
    </table>
  </div>

  <!-- Totales -->
  <div class="row mt-3">
    <div class="col-md-4">
      <ul class="list-group">
        <li class="list-group-item d-flex justify-content-between">
          <span>Neto</span> <strong id="neto">0</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>IVA (19%)</span> <strong id="iva">0</strong>
        </li>
        <li class="list-group-item d-flex justify-content-between">
          <span>Total</span> <strong id="total">0</strong>
        </li>
      </ul>
    </div>

    <!-- Pago -->
    <div class="col-md-8">
      <div class="mb-3">
        <label for="metodoPago" class="form-label">Método de pago</label>
        <select id="metodoPago" class="form-select">
          <option value="efectivo" selected>Efectivo</option>
          <option value="debito">Débito</option>
          <option value="credito">Crédito</option>
          <option value="mixto">Mixto</option>
        </select>
      </div>

      <!-- Campos de pago dinámicos -->
      <div id="montoEfectivo" class="mb-2">
        <input type="number" class="form-control" placeholder="Monto efectivo">
      </div>
      <div id="montoDebito" class="mb-2 d-none">
        <input type="number" class="form-control" placeholder="Monto débito">
      </div>
      <div id="montoCredito" class="mb-2 d-none">
        <input type="number" class="form-control" placeholder="Monto crédito">
      </div>

      <div class="text-end">
        <button id="btnPagar" class="btn btn-success btn-lg">
          <i class="bi bi-cash"></i> Pagar
        </button>
      </div>
    </div>
  </div>

</div>

<!-- JSON productos -->
<script id="productos-data" type="application/json">
  {{ productos_json|safe }}
</script>

<!-- URLs para JavaScript -->
<script id="ventas-js" 
        data-url-crear-venta="{% url 'crear_venta' %}"
        data-url-lista-ventas="{% url 'lista_ventas' %}"></script>

<!-- JS ventas -->
<script src="{% static 'js/ventas.js' %}"></script>

{% endblock %}
