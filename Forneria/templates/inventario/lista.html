{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">

  <!-- Título + Botón Nuevo -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="bi bi-box"></i> Productos</h3>

    <a href="{% url 'crear_producto' %}" class="btn btn-primary">
      <i class="bi bi-plus-lg"></i> Nuevo Producto
    </a>
  </div>

  <!-- Filtros -->
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-3">
      <input type="text" name="q" value="{{ request.GET.q }}" class="form-control"
             placeholder="Buscar por nombre">
    </div>

    <div class="col-md-2">
      <select name="categoria" class="form-select">
        <option value="">Todas las categorías</option>
        {% for c in categorias %}
          <option value="{{ c.id }}"
            {% if request.GET.categoria == c.id|stringformat:"s" %}
              selected
            {% endif %}
          >
            {{ c.nombre }}
          </option>
        {% endfor %}
      </select>
    </div>

    <div class="col-md-2">
      <input type="number" name="precio_min" value="{{ request.GET.precio_min }}"
             class="form-control" placeholder="Precio min">
    </div>

    <div class="col-md-2">
      <input type="number" name="precio_max" value="{{ request.GET.precio_max }}"
             class="form-control" placeholder="Precio max">
    </div>

    <div class="col-md-2">
      <button class="btn btn-primary w-100">
        <i class="bi bi-search"></i> Filtrar
      </button>
    </div>
  </form>

  <!-- Tabla -->
  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Caducidad</th>
          <th>Categoría</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% for p in productos %}
          <tr>
            <td>{{ p.id }}</td>
            <td>{{ p.nombre }}</td>
            <td>${{ p.precio }}</td>
            <td>{{ p.stock_actual|default:"0" }}</td>
            <td>{{ p.caducidad|date:"Y-m-d" }}</td>
            <td>{{ p.categorias.nombre }}</td>

            <td class="text-end">

              <!-- Editar -->
              <a href="{% url 'editar_producto' p.id %}" class="btn btn-sm btn-warning">
                <i class="bi bi-pencil"></i>
              </a>

              <!-- Eliminar -->
              <a href="{% url 'eliminar_producto' p.id %}"
                 class="btn btn-sm btn-danger btn-eliminar"
                 data-mensaje="¿Eliminar este producto?">
                <i class="bi bi-trash"></i>
              </a>

            </td>
          </tr>

        {% empty %}
          <tr>
            <td colspan="7" class="text-center text-muted">
              No hay productos registrados.
            </td>
          </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>
{% endblock %}
